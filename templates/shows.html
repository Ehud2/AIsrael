<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>כל הסדרות - אנימה פלוס</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/showall.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                     <a href="/" style="text-decoration: none; color: inherit;">
                        <span class="logo-icon">🎌</span>
                        <span class="logo-text">אנימה<span class="logo-plus">פלוס</span></span>
                    </a>
                </div>
                <nav class="nav">
                    <a href="/" class="nav-link" data-nav-id="all">הכל</a>
                    <a href="/shows" class="nav-link active" data-nav-id="series">סדרות</a>
                    <a href="/movies" class="nav-link" data-nav-id="movie">סרטים</a>
                    <a href="#" class="nav-link">המועדפים שלי</a>
                </nav>
                <div class="header-actions">
                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="חיפוש סדרה...">
                        <span class="search-icon">🔍</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="page-header">
            <div class="container">
                <h1>כל הסדרות</h1>
            </div>
        </section>

        <div class="container">
            <section class="filters-bar">
                <div class="filter-group">
                    <label for="genreFilter" class="filter-label">ז'אנר:</label>
                    <select id="genreFilter" class="filter-select">
                        <option value="all">כל הז'אנרים</option>
                        <option value="פעולה">פעולה</option>
                        <option value="הרפתקאות">הרפתקאות</option>
                        <option value="רומנטיקה">רומנטיקה</option>
                        <option value="קומדיה">קומדיה</option>
                        <option value="פנטזיה">פנטזיה</option>
                        <option value="דרמה">דרמה</option>
                        <option value="מותחן">מותחן</option>
                        <option value="מדע בדיוני ופנטזיה">מדע בדיוני ופנטזיה</option>
                        <option value="אימה">אימה</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="ratingFilter" class="filter-label">דירוג מינימלי:</label>
                    <select id="ratingFilter" class="filter-select">
                        <option value="0">הכל</option>
                        <option value="8">8+</option>
                        <option value="7">7+</option>
                        <option value="6">6+</option>
                        <option value="5">5+</option>
                    </select>
                </div>
            </section>

            <section class="content-grid-container">
                <div id="contentGrid">
                    <!-- Series cards will be inserted here by JavaScript -->
                </div>
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modal and Footer are identical to movies.html -->
    <div id="animeModal" class="modal">...</div>
    <footer class="footer">...</footer>

    <script>
        // *** The ONLY CHANGE from movies.html is this line: ***
        const CONTENT_TYPE = 'series';

        // The rest of the script is IDENTICAL to movies.html
        // Copy the entire <script> block from movies.html here.
        let currentSearch = '';
        let currentGenre = 'all';
        let currentRating = 0;
        let allContentData = [];

        const contentGrid = document.getElementById('contentGrid');
        const loading = document.getElementById('loading');
        const searchInput = document.getElementById('searchInput');
        const genreFilter = document.getElementById('genreFilter');
        const ratingFilter = document.getElementById('ratingFilter');

        async function fetchData() {
            loading.style.display = 'flex';
            contentGrid.innerHTML = '';
            
            try {
                const url = `/api/anime?type=${CONTENT_TYPE}`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('Network response was not ok');
                allContentData = await response.json();
                applyFiltersAndRender();
            } catch (error) {
                console.error('Failed to fetch data:', error);
                displayMessage("שגיאה בטעינת הנתונים.");
            } finally {
                loading.style.display = 'none';
            }
        }

        function applyFiltersAndRender() {
            let filteredData = allContentData;

            if (currentSearch) {
                filteredData = filteredData.filter(item => 
                    item.title_he.toLowerCase().includes(currentSearch) ||
                    item.title.toLowerCase().includes(currentSearch)
                );
            }

            if (currentGenre !== 'all') {
                filteredData = filteredData.filter(item => item.genre && item.genre.includes(currentGenre));
            }

            if (currentRating > 0) {
                filteredData = filteredData.filter(item => item.rating >= currentRating);
            }
            
            populateGrid(filteredData);
        }
        
        function populateGrid(data) {
            contentGrid.innerHTML = '';
            if (data.length === 0) {
                displayMessage("לא נמצאו תוצאות התואמות את הסינון שלך.");
                return;
            }
            data.forEach(item => {
                const card = createAnimeCard(item);
                contentGrid.appendChild(card);
            });
        }

        function displayMessage(message) {
            contentGrid.innerHTML = `<p class="grid-message">${message}</p>`;
        }
        
        function createAnimeCard(anime) {
            const card = document.createElement('div');
            card.className = 'anime-card';
            card.onclick = () => openModal(anime.id);
            
            card.innerHTML = `
                <div class="anime-image">
                    <img src="${anime.image}" alt="${anime.title_he}" onerror="this.src='https://placehold.co/300x420/ff6b6b/ffffff?text=Image+Error'">
                    <div class="anime-overlay"><button class="play-btn">▶</button></div>
                    <span class="anime-type">${anime.type === 'series' ? 'סדרה' : 'סרט'}</span>
                </div>
                <div class="anime-info">
                    <h3 class="anime-title">${anime.title_he}</h3>
                    <div class="anime-meta">
                        <span class="rating">⭐ ${anime.rating}</span>
                        <span class="year">${anime.year}</span>
                    </div>
                </div>
            `;
            return card;
        }

        document.addEventListener('DOMContentLoaded', fetchData);
        searchInput.addEventListener('input', debounce(e => { currentSearch = e.target.value.toLowerCase(); applyFiltersAndRender(); }, 300));
        genreFilter.addEventListener('change', e => { currentGenre = e.target.value; applyFiltersAndRender(); });
        ratingFilter.addEventListener('change', e => { currentRating = parseFloat(e.target.value); applyFiltersAndRender(); });
        function debounce(func, wait) { let timeout; return function executedFunction(...args) { const later = () => { clearTimeout(timeout); func(...args); }; clearTimeout(timeout); timeout = setTimeout(later, wait); }; }
        // Don't forget to copy the modal html and its JS functions (openModal, closeModal)
    </script>
</body>
</html>
